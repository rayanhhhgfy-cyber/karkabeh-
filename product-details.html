<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تفاصيل المنتج</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
/* CSS */
@import url('https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&display=swap');

:root {
--primary-color: #f75d35; /* لون برتقالي شبيه بـ SHEIN */
--secondary-color: #fff;
--bg-color: #f8f8f8;
--text-color: #333;
--gray-light: #eee;
--gray-medium: #999;
--red-color: #dc3545;
}

body {
font-family: 'Almarai', sans-serif;
margin: 0;
padding: 0;
background-color: var(--bg-color);
direction: rtl;
text-align: right;
padding-bottom: 70px;
}

.bottom-navbar {
position: fixed;
bottom: 0;
right: 0;
left: 0;
display: flex;
justify-content: space-around;
align-items: center;
height: 60px;
background-color: var(--secondary-color);
box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
z-index: 1000;
}

.nav-item {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
text-decoration: none;
color: var(--gray-medium);
font-size: 0.8rem;
transition: color 0.3s;
}

.nav-item i {
font-size: 1.2rem;
margin-bottom: 4px;
}

.nav-item:hover, .nav-item.active {
color: var(--primary-color);
}

.main-content {
padding: 0;
}

/* Product page styles */
.product-image-slider {
width: 100%;
height: 450px;
overflow: hidden;
position: relative;
}

.product-image-slider img {
width: 100%;
height: 100%;
object-fit: cover;
display: none;
}

.product-image-slider img.active {
display: block;
}

.product-info-container {
padding: 20px;
background-color: var(--secondary-color);
border-bottom: 1px solid var(--gray-light);
}

.product-header {
display: flex;
flex-direction: column;
}

.product-price {
font-size: 1.5rem;
font-weight: bold;
color: var(--primary-color);
margin-bottom: 5px;
}

.product-price .original-price {
font-size: 0.9rem;
color: var(--gray-medium);
text-decoration: line-through;
margin-right: 10px;
}

.product-rating-row {
display: flex;
align-items: center;
margin-bottom: 15px;
}

.product-rating-row .stars {
color: gold;
font-size: 1.2rem;
margin-left: 5px;
}

.product-rating-row .rating-text {
font-size: 0.9rem;
color: var(--gray-medium);
}

.product-name {
font-size: 1.3rem;
font-weight: bold;
color: var(--text-color);
margin-bottom: 15px;
}

.product-description {
color: var(--gray-medium);
line-height: 1.6;
}

.product-services {
padding: 20px;
background-color: var(--secondary-color);
margin-top: 10px;
border-bottom: 1px solid var(--gray-light);
}

.service-item {
display: flex;
align-items: center;
margin-bottom: 15px;
font-size: 1rem;
color: var(--text-color);
}

.service-item i {
margin-left: 10px;
color: var(--primary-color);
}

/* Location selector button */
.location-selector {
display: flex;
align-items: center;
justify-content: space-between;
background-color: var(--secondary-color);
padding: 15px 20px;
margin-top: 10px;
border-radius: 8px;
box-shadow: 0 2px 5px rgba(0,0,0,0.05);
cursor: pointer;
}

.location-selector span {
font-weight: bold;
}

/* Action buttons */
.product-actions {
padding: 20px;
background-color: var(--secondary-color);
border-top: 1px solid var(--gray-light);
display: flex;
justify-content: center;
gap: 10px;
}

.product-actions button {
padding: 15px;
border: none;
border-radius: 50px;
font-size: 1.1rem;
font-weight: bold;
cursor: pointer;
transition: background-color 0.3s, transform 0.2s;
display: flex;
align-items: center;
justify-content: center;
}

#addToCartBtn {
flex: 1;
background-color: var(--primary-color);
color: var(--secondary-color);
}

#addToCartBtn:hover {
background-color: #e64e28;
transform: translateY(-2px);
}

#buyNowBtn {
flex: 1;
background-color: #28a745;
color: var(--secondary-color);
}

#buyNowBtn:hover {
background-color: #218838;
transform: translateY(-2px);
}

.product-actions button i {
margin-left: 10px;
}

/* Comments section */
.comments-section {
padding: 20px;
background-color: var(--secondary-color);
margin-top: 10px;
}

.comments-section h3 {
border-bottom: 2px solid var(--gray-light);
padding-bottom: 10px;
margin-bottom: 20px;
color: var(--text-color);
}

.comment {
margin-bottom: 15px;
border-bottom: 1px solid var(--gray-light);
padding-bottom: 10px;
}

.comment-header {
font-weight: bold;
color: var(--text-color);
display: flex;
justify-content: space-between;
}

.comment-text {
color: var(--gray-medium);
margin-top: 5px;
}

.add-comment-form {
margin-top: 20px;
}

.add-comment-form textarea {
width: 100%;
padding: 10px;
border: 1px solid var(--gray-light);
border-radius: 8px;
box-sizing: border-box;
resize: vertical;
}

.add-comment-form button {
background-color: var(--primary-color);
color: var(--secondary-color);
border: none;
padding: 10px 20px;
border-radius: 5px;
cursor: pointer;
margin-top: 10px;
}

/* Suggested products */
.suggested-products {
padding: 20px;
background-color: var(--secondary-color);
margin-top: 10px;
}

.suggested-products h3 {
border-bottom: 2px solid var(--gray-light);
padding-bottom: 10px;
margin-bottom: 20px;
color: var(--text-color);
}

.suggested-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 15px;
}

.suggested-card {
background-color: var(--bg-color);
border-radius: 8px;
overflow: hidden;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
text-decoration: none;
color: inherit;
}

.suggested-card img {
width: 100%;
height: 100px;
object-fit: cover;
}

.suggested-card-info {
padding: 10px;
}

.suggested-card-info h4 {
font-size: 0.9rem;
margin: 0;
line-height: 1.3;
}

.suggested-card-info p {
font-size: 0.8rem;
color: var(--primary-color);
font-weight: bold;
margin-top: 5px;
}

/* Modal styles */
.modal {
display: none;
position: fixed;
z-index: 2000;
left: 0;
top: 0;
width: 100%;
height: 100%;
overflow: auto;
background-color: rgba(0, 0, 0, 0.6);
padding-top: 60px;
}

.modal-content {
background-color: var(--secondary-color);
margin: 5% auto;
padding: 20px;
border-radius: 10px;
width: 90%;
max-width: 500px;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
position: relative;
text-align: center;
}

.close-btn {
color: var(--gray-medium);
float: left;
font-size: 28px;
font-weight: bold;
}

.close-btn:hover, .close-btn:focus {
color: var(--text-color);
text-decoration: none;
cursor: pointer;
}

.modal-content h3 {
text-align: right;
margin-bottom: 10px;
}

.modal-content hr {
border: 1px solid var(--gray-light);
margin-bottom: 15px;
}

.payment-option {
padding: 15px;
border: 1px solid var(--gray-light);
border-radius: 8px;
margin-bottom: 15px;
display: flex;
align-items: center;
justify-content: space-between;
cursor: pointer;
transition: border-color 0.2s;
}

.payment-option:hover {
border-color: var(--primary-color);
}

.payment-option i {
font-size: 1.5rem;
margin-left: 10px;
}

.payment-option span {
font-weight: bold;
flex-grow: 1;
}

.not-available {
opacity: 0.5;
cursor: not-allowed;
}

.contact-info, .quantity-control-modal {
text-align: right;
margin-bottom: 15px;
}

.contact-info label {
font-weight: bold;
color: var(--text-color);
display: block;
margin-bottom: 5px;
}

.contact-info input {
width: 100%;
padding: 10px;
border: 1px solid var(--gray-light);
border-radius: 8px;
box-sizing: border-box;
font-family: 'Almarai', sans-serif;
}

.quantity-control-modal {
display: flex;
align-items: center;
justify-content: center;
font-size: 1.1rem;
}

.quantity-control-modal button {
background-color: var(--gray-light);
border: none;
width: 30px;
height: 30px;
border-radius: 50%;
cursor: pointer;
transition: background-color 0.2s;
display: flex;
align-items: center;
justify-content: center;
font-size: 1rem;
}

.quantity-control-modal button:hover {
background-color: var(--gray-medium);
color: var(--secondary-color);
}

.quantity-control-modal span {
width: 40px;
text-align: center;
margin: 0 5px;
font-size: 1.1rem;
}

#map-container {
width: 100%;
height: 250px;
border-radius: 8px;
margin-top: 15px;
z-index: 1;
}

</style>
</head>
<body>

<div class="bottom-navbar">
<a href="reel.html" class="nav-item">
<i class="fas fa-home"></i>
<span>الرئيسية</span>
</a>
<a href="cart.html" class="nav-item">
<i class="fas fa-shopping-cart"></i>
<span>السلة</span>
</a>
<a href="notes.html" class="nav-item">
<i class="fas fa-plus-circle"></i>
<span>ملاحظة</span>
</a>
<a href="account.html" class="nav-item">
<i class="fas fa-user"></i>
<span>الحساب</span>
</a>
</div>

<div class="main-content">
<div class="product-image-slider" id="productImageSlider">
</div>

<div class="product-info-container">
<div class="product-header">
<span class="product-price" id="productPrice"></span>
</div>
<div class="product-rating-row">
<span class="stars" id="productRating"></span>
<span class="rating-text" id="productSales"></span>
</div>
<h1 class="product-name" id="productName"></h1>
<p class="product-description" id="productDescription"></p>
</div>

<div class="product-services">
<div class="service-item">
<i class="fas fa-truck"></i>
<span id="deliveryTime"></span>
</div>
<div class="service-item">
<i class="fas fa-credit-card"></i>
<span>خدمة الدفع عند الاستلام</span>
</div>
<div class="service-item">
<i class="fas fa-undo"></i>
<span>سياسة الإرجاع</span>
</div>
<div class="location-selector" id="locationSelector">
<i class="fas fa-map-marker-alt"></i>
<span>حدد موقعك</span>
<i class="fas fa-chevron-left"></i>
</div>
</div>

<div class="product-actions">
<button id="buyNowBtn">
<i class="fas fa-bolt"></i>
شراء الآن
</button>
<button id="addToCartBtn">
<i class="fas fa-shopping-cart"></i>
أضف إلى السلة
</button>
</div>

<div class="comments-section">
<h3 id="commentsTitle">تعليقات (+<span id="commentsCount">0</span>)</h3>
<div id="commentsList">
</div>
<div class="add-comment-form">
<h4>أضف تعليقك</h4>
<textarea id="commentInput" placeholder="اكتب تعليقك هنا..."></textarea>
<button id="submitCommentBtn">إرسال</button>
</div>
</div>

<div class="suggested-products">
<h3>منتجات قد تعجبك أيضاً</h3>
<div class="suggested-grid" id="suggestedProductsGrid">
</div>
</div>
</div>

<div id="paymentModal" class="modal">
<div class="modal-content">
<span class="close-btn" data-modal="paymentModal">&times;</span>
<h3 style="text-align: right;">أدخل معلومات الطلب</h3>
<hr style="border: 1px solid var(--gray-light);">
<div class="contact-info">
<label for="phoneNumber">رقم الهاتف:</label>
<input type="tel" id="phoneNumber" placeholder="أدخل رقم هاتفك هنا..." dir="ltr">
</div>

<div class="quantity-control-modal">
<label>الكمية:</label>
<button id="decreaseBtn">-</button>
<span id="quantityDisplay">1</span>
<button id="increaseBtn">+</button>
</div>

<h3 style="text-align: right;">اختر طريقة الدفع</h3>
<hr style="border: 1px solid var(--gray-light);">
<div id="paymentOptionsContainer">
<div class="payment-option">
<i class="fab fa-paypal"></i>
<span>PayPal</span>
</div>
<div class="payment-option" data-payment-method="cash">
<i class="fas fa-hand-holding-usd"></i>
<span>دفع عند الاستلام (الأردن فقط)</span>
</div>
<div class="payment-option not-available">
<i class="fas fa-credit-card"></i>
<span>Visa / Click (غير متوفر)</span>
</div>
</div>
</div>
</div>

<div id="locationModal" class="modal">
<div class="modal-content">
<span class="close-btn" data-modal="locationModal">&times;</span>
<h3 style="text-align: right;">حدد موقعك</h3>
<hr style="border: 1px solid var(--gray-light);">
<div id="map-container"></div>
<p style="text-align: center; font-weight: bold; margin-top: 15px;">الموقع المحدد: <span id="selectedLocation">لم يتم التحديد</span></p>
<button id="confirmLocationBtn" style="width: 100%; padding: 12px; margin-top: 15px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;">تأكيد الموقع</button>
</div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// JavaScript
document.addEventListener('DOMContentLoaded', () => {
const productImageSlider = document.getElementById('productImageSlider');
const productName = document.getElementById('productName');
const productPrice = document.getElementById('productPrice');
const productRating = document.getElementById('productRating');
const productSales = document.getElementById('productSales');
const productDescription = document.getElementById('productDescription');
const deliveryTimeSpan = document.getElementById('deliveryTime');
const commentsList = document.getElementById('commentsList');
const commentsCountSpan = document.getElementById('commentsCount');
const commentInput = document.getElementById('commentInput');
const submitCommentBtn = document.getElementById('submitCommentBtn');
const suggestedProductsGrid = document.getElementById('suggestedProductsGrid');
const addToCartBtn = document.getElementById('addToCartBtn');
const buyNowBtn = document.getElementById('buyNowBtn');
const paymentModal = document.getElementById('paymentModal');
const locationSelector = document.getElementById('locationSelector');
const locationModal = document.getElementById('locationModal');
const selectedLocationSpan = document.getElementById('selectedLocation');
const confirmLocationBtn = document.getElementById('confirmLocationBtn');
const phoneNumberInput = document.getElementById('phoneNumber');
const quantityDisplay = document.getElementById('quantityDisplay');
const increaseBtn = document.getElementById('increaseBtn');
const decreaseBtn = document.getElementById('decreaseBtn');
const cashPaymentOption = document.querySelector('[data-payment-method="cash"]');

const allProducts = JSON.parse(localStorage.getItem('products')) || [];
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');
const product = allProducts.find(p => p.id == productId);

if (product) {
product.images.forEach((imgSrc, index) => {
const img = document.createElement('img');
img.src = imgSrc;
if (index === 0) {
img.className = 'active';
}
productImageSlider.appendChild(img);
});

productName.textContent = product.name;
productPrice.innerHTML = `${product.price} JOD <span class="original-price">${(product.price * 1.2).toFixed(2)} JOD</span>`;

const stars = [];
const rating = parseFloat(product.rating);
for (let i = 0; i < 5; i++) {
if (i < Math.floor(rating)) {
stars.push('<i class="fas fa-star"></i>');
} else if (i === Math.floor(rating) && rating % 1 !== 0) {
stars.push('<i class="fas fa-star-half-alt"></i>');
} else {
stars.push('<i class="far fa-star"></i>');
}
}
productRating.innerHTML = stars.join('');
productSales.textContent = `(+${product.sales > 1000 ? '1k' : product.sales}+)`;

productDescription.textContent = product.description;
deliveryTimeSpan.textContent = product.deliveryTime || 'غير محدد';

const suggestedProducts = allProducts.filter(p => p.id != productId && p.category === product.category).slice(0, 4);
suggestedProducts.forEach(suggested => {
suggestedProductsGrid.innerHTML += `
<a href="product-details.html?id=${suggested.id}" class="suggested-card">
<img src="${suggested.images[0]}" alt="${suggested.name}">
<div class="suggested-card-info">
<h4>${suggested.name}</h4>
<p>${suggested.price} JOD</p>
</div>
</a>
`;
});
} else {
productName.textContent = 'المنتج غير موجود';
document.querySelector('.product-info-container').innerHTML = '<p style="text-align:center;">عذراً، لم يتم العثور على هذا المنتج.</p>';
}

const renderComments = () => {
const comments = JSON.parse(localStorage.getItem(`comments_${productId}`)) || [];
commentsList.innerHTML = '';
commentsCountSpan.textContent = comments.length;
if (comments.length === 0) {
commentsList.innerHTML = '<p>لا توجد تعليقات حتى الآن.</p>';
} else {
comments.forEach(comment => {
commentsList.innerHTML += `
<div class="comment">
<div class="comment-header">${comment.user}<span>${comment.date}</span></div>
<p class="comment-text">${comment.text}</p>
</div>
`;
});
}
};
renderComments();

submitCommentBtn.addEventListener('click', () => {
const commentText = commentInput.value.trim();
if (commentText) {
const user = JSON.parse(localStorage.getItem('userAccount')) || { fullName: 'زائر' };
const newComment = {
user: user.fullName || 'زائر',
text: commentText,
date: new Date().toLocaleDateString('ar-AR', { day: 'numeric', month: 'long', year: 'numeric' })
};
let comments = JSON.parse(localStorage.getItem(`comments_${productId}`)) || [];
comments.push(newComment);
localStorage.setItem(`comments_${productId}`, JSON.stringify(comments));
commentInput.value = '';
renderComments();
} else {
alert('الرجاء كتابة تعليق قبل الإرسال.');
}
});

addToCartBtn.addEventListener('click', () => {
if (product) {
let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
const existingItem = cartItems.find(item => item.id === product.id);
if (existingItem) {
existingItem.quantity += 1;
} else {
product.quantity = 1;
cartItems.push(product);
}
localStorage.setItem('cartItems', JSON.stringify(cartItems));
alert('تمت إضافة المنتج إلى السلة بنجاح!');
}
});

// --- منطق الخريطة والكمية ورقم الهاتف الجديد ---
let selectedLatLng = null;

buyNowBtn.addEventListener('click', () => {
paymentModal.style.display = "block";
});

locationSelector.addEventListener('click', () => {
locationModal.style.display = "block";
setTimeout(() => {
initMap();
}, 100);
});

document.querySelectorAll('.close-btn').forEach(btn => {
btn.addEventListener('click', (event) => {
const modalId = event.target.dataset.modal;
document.getElementById(modalId).style.display = "none";
});
});

window.addEventListener('click', (event) => {
if (event.target == paymentModal) {
paymentModal.style.display = "none";
}
if (event.target == locationModal) {
locationModal.style.display = "none";
}
});

let map = null;
let marker = null;

function initMap() {
if (map !== null) {
map.remove();
}

const defaultLocation = [31.9539, 35.9106];
map = L.map('map-container').setView(defaultLocation, 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '© OpenStreetMap contributors'
}).addTo(map);
marker = L.marker(defaultLocation).addTo(map);

map.on('click', function(e) {
marker.setLatLng(e.latlng);
selectedLatLng = e.latlng;
const lat = e.latlng.lat.toFixed(4);
const lng = e.latlng.lng.toFixed(4);
selectedLocationSpan.textContent = `خط الطول: ${lat}, خط العرض: ${lng}`;
});
}

confirmLocationBtn.addEventListener('click', () => {
if (selectedLatLng) {
locationModal.style.display = "none";
} else {
alert('الرجاء تحديد موقع على الخريطة أولاً.');
}
});

increaseBtn.addEventListener('click', () => {
let currentQuantity = parseInt(quantityDisplay.textContent);
quantityDisplay.textContent = currentQuantity + 1;
});

decreaseBtn.addEventListener('click', () => {
let currentQuantity = parseInt(quantityDisplay.textContent);
if (currentQuantity > 1) {
quantityDisplay.textContent = currentQuantity - 1;
}
});

// وظيفة تأكيد الشراء وإرسال الطلب للأدمن
cashPaymentOption.addEventListener('click', () => {
const phoneNumber = phoneNumberInput.value;
const quantity = parseInt(quantityDisplay.textContent);

if (!phoneNumber || !selectedLatLng) {
alert('الرجاء إدخال رقم الهاتف وتحديد موقعك أولاً.');
return;
}

if (product) {
// إنشاء كائن الطلب الجديد
const newOrder = {
id: Date.now(),
productName: product.name,
productImage: product.images[0],
quantity: quantity,
price: product.price,
totalPrice: (product.price * quantity).toFixed(2),
phoneNumber: phoneNumber,
location: {
lat: selectedLatLng.lat,
lng: selectedLatLng.lng
},
status: 'جديد',
date: new Date().toLocaleDateString('ar-AR', { day: 'numeric', month: 'long', year: 'numeric' })
};

// قراءة الطلبات الموجودة وإضافة الطلب الجديد
const existingOrders = JSON.parse(localStorage.getItem('adminOrders')) || [];
existingOrders.push(newOrder);
localStorage.setItem('adminOrders', JSON.stringify(existingOrders));

alert('تم تأكيد طلبك بنجاح! سيتم التواصل معك قريباً.');
paymentModal.style.display = "none";

// إعادة ضبط القيم بعد الشراء
phoneNumberInput.value = '';
quantityDisplay.textContent = '1';
selectedLatLng = null;
selectedLocationSpan.textContent = 'لم يتم التحديد';

} else {
alert('عذراً، لا يمكن إكمال الطلب. المنتج غير موجود.');
}
});
});
</script>
</body>
</html>
	
